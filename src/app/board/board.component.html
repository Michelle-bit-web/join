<section class="layout-container">
  <div class="board-header">
    <div class="header-headline">
      <h1>Board</h1>
      <img
        class="add-icon"
        src="assets/img/icons/add-box-fill.png"
        alt="add contact button"
        (click)="openAddOrEditOverlay('open')"
      />
    </div>

    <div class="header-controls">
      <div class="search-input-container">
        <input
          type="text"
          placeholder="Find Task"
          [(ngModel)]="searchTerm"
          (input)="onSearchInput()"
          #searchInput
        />

        <!-- NEU -->
        @if (searchTerm.trim()) {
        <div
          class="clear-search-wrapper"
          (click)="clearSearch(); searchInput.focus()"
        >
          <img
            src="assets/img/icons/close.png"
            alt="Clear search"
            class="clear-search-icon"
          />
        </div>
        }

        <div class="separator"></div>
        <div class="search-icon-wrapper">
          <img
            src="assets/img/icons/search.png"
            alt="Search"
            class="search-icon"
          />
        </div>
      </div>

      <button (click)="openAddOrEditOverlay('open')">Add Task +</button>
    </div>
  </div>

  <div class="task-columns">
    <div class="column">
      <div class="column-header">
        <h2>To do</h2>
        <div class="icon-container" (click)="openAddOrEditOverlay('open')">
          <img
            class="default-icon"
            src="assets/img/icons/add-box.png"
            alt="Add new task"
          />
          <img
            class="hover-icon"
            src="assets/img/icons/add-box-hover.png"
            alt="Add new task"
          />
        </div>
      </div>

      <div
        cdkDropList
        #todoList="cdkDropList"
        [cdkDropListData]="todo"
        id="todoList"
        [cdkDropListConnectedTo]="[inprogressList, awaitfeedbackList, doneList]"
        class="drop-list"
        [class.drop-list-empty]="getFilteredTasks('to-do').length === 0"
        (cdkDropListDropped)="drop($event)"
      >
        @if (getFilteredTasks('to-do').length === 0) {
        <div class="empty-column">
          @if (searchTerm.trim()) { No matching tasks found } @else { No tasks
          To do }
        </div>
        } @for (task of getFilteredTasks('to-do'); track task.id) {
        <app-task
          [cdkDragData]="task"
          [cdkDragStartDelay]="250"
          cdkDrag
          (taskSelected)="openTaskDetail($event)"
          [task]="task"
          [subtaskList]="getSubtasksForTask(task.id)"
          (contacts)="getContactList($event)"
        ></app-task>
        }
      </div>
    </div>

    <div class="column">
      <div class="column-header">
        <h2>In progress</h2>
        <div class="icon-container" (click)="openAddOrEditOverlay('open')">
          <img
            class="default-icon"
            src="assets/img/icons/add-box.png"
            alt="Add new task"
          />
          <img
            class="hover-icon"
            src="assets/img/icons/add-box-hover.png"
            alt="Add new task"
          />
        </div>
      </div>
      <div
        cdkDropList
        #inprogressList="cdkDropList"
        id="inprogressList"
        [cdkDropListData]="inprogress"
        [cdkDropListConnectedTo]="[todoList, awaitfeedbackList, doneList]"
        class="drop-list"
        [class.drop-list-empty]="getFilteredTasks('in-progress').length === 0"
        (cdkDropListDropped)="drop($event)"
      >
        @if (getFilteredTasks('in-progress').length === 0) {
        <div class="empty-column">
          @if (searchTerm.trim()) { No matching tasks found } @else { No tasks
          in progress }
        </div>
        } @for (task of getFilteredTasks('in-progress'); track task.id) {
        <app-task
          [cdkDragData]="task"
          [cdkDragStartDelay]="250"
          cdkDrag
          (taskSelected)="openTaskDetail($event)"
          [task]="task"
          [subtaskList]="getSubtasksForTask(task.id)"
          (contacts)="getContactList($event)"
        ></app-task>
        }
      </div>
    </div>

    <div class="column">
      <div class="column-header">
        <h2>Await feedback</h2>
        <div class="icon-container" (click)="openAddOrEditOverlay('open')">
          <img
            class="default-icon"
            src="assets/img/icons/add-box.png"
            alt="Add new task"
          />
          <img
            class="hover-icon"
            src="assets/img/icons/add-box-hover.png"
            alt="Add new task"
          />
        </div>
      </div>

      <div
        cdkDropList
        #awaitfeedbackList="cdkDropList"
        [cdkDropListData]="awaitfeedback"
        id="awaitfeedbackList"
        [cdkDropListConnectedTo]="[todoList, inprogressList, doneList]"
        class="drop-list"
        [class.drop-list-empty]="
          getFilteredTasks('await-feedback').length === 0
        "
        (cdkDropListDropped)="drop($event)"
      >
        @if (getFilteredTasks('await-feedback').length === 0) {
        <div class="empty-column">
          @if (searchTerm.trim()) { No matching tasks found } @else { No tasks
          for feedback }
        </div>
        } @for (task of getFilteredTasks('await-feedback'); track task.id) {
        <app-task
          [cdkDragData]="task"
          [cdkDragStartDelay]="250"
          cdkDrag
          (taskSelected)="openTaskDetail($event)"
          [task]="task"
          [subtaskList]="getSubtasksForTask(task.id)"
          (contacts)="getContactList($event)"
        ></app-task>
        }
      </div>
    </div>

    <div class="column">
      <div class="column-header">
        <h2>Done</h2>
      </div>

      <div
        cdkDropList
        #doneList="cdkDropList"
        [cdkDropListData]="done"
        id="doneList"
        [cdkDropListConnectedTo]="[todoList, inprogressList, awaitfeedbackList]"
        class="drop-list"
        [class.drop-list-empty]="getFilteredTasks('done').length === 0"
        (cdkDropListDropped)="drop($event)"
      >
        @if (getFilteredTasks('done').length === 0) {
        <div class="empty-column">
          @if (searchTerm.trim()) { No matching tasks found } @else { No tasks
          done }
        </div>
        } @for (task of getFilteredTasks('done'); track task.id) {
        <app-task
          [cdkDragData]="task"
          [cdkDragStartDelay]="250"
          cdkDrag
          (taskSelected)="openTaskDetail($event)"
          [task]="task"
          [subtaskList]="getSubtasksForTask(task.id)"
          (contacts)="getContactList($event)"
        ></app-task>
        }
      </div>
    </div>
  </div>
</section>

<!-- vorerst hier eingebaut, um daran arbeiten zu können-->

<!-- Detailansicht für Task -->
<!-- <div
  class="task-overlay"
  [@slideInOut]="animationDirection"
  (@slideInOut.done)="onOverlayAnimationDone($event)"
  [class.backgroundVisible]="backgroundVisible"
  *ngIf="backgroundVisible"
>
  <app-task-details
    *ngIf="selectedTask"
    (closeTaskDetails)="closeDetailsOverlay($event)"
    (editTask)="openAddOrEditOverlay($event)"
    (subtaskChanged)="onSubtaskUpdate($event)"
    [task]="selectedTask"
    [contactList]="contactList"
  ></app-task-details>
</div> -->

<!-- Detailansicht für Task -->
<!-- <div
  class="task-overlay"
  [@slideInOut]="animationDirection"
  (@slideInOut.done)="onOverlayAnimationDone($event)"
  [class.backgroundVisible]="backgroundVisible"
  *ngIf="backgroundVisible"
>
 <div class="content-wrapper">
  <div class="close-btn-wrapper">
    <button class="btn-close" (click)="closeDetailsOverlay('close')" >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <mask id="mask0_331509_883" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
                    <rect width="24" height="24" fill="#D9D9D9"/>
                </mask>
                <g mask="url(#mask0_331509_883)">
                    <path d="M12 13.4L7.10005 18.3C6.91672 18.4834 6.68338 18.575 6.40005 18.575C6.11672 18.575 5.88338 18.4834 5.70005 18.3C5.51672 18.1167 5.42505 17.8834 5.42505 17.6C5.42505 17.3167 5.51672 17.0834 5.70005 16.9L10.6 12L5.70005 7.10005C5.51672 6.91672 5.42505 6.68338 5.42505 6.40005C5.42505 6.11672 5.51672 5.88338 5.70005 5.70005C5.88338 5.51672 6.11672 5.42505 6.40005 5.42505C6.68338 5.42505 6.91672 5.51672 7.10005 5.70005L12 10.6L16.9 5.70005C17.0834 5.51672 17.3167 5.42505 17.6 5.42505C17.8834 5.42505 18.1167 5.51672 18.3 5.70005C18.4834 5.88338 18.575 6.11672 18.575 6.40005C18.575 6.68338 18.4834 6.91672 18.3 7.10005L13.4 12L18.3 16.9C18.4834 17.0834 18.575 17.3167 18.575 17.6C18.575 17.8834 18.4834 18.1167 18.3 18.3C18.1167 18.4834 17.8834 18.575 17.6 18.575C17.3167 18.575 17.0834 18.4834 16.9 18.3L12 13.4Z" fill="#2A3647"/>
                </g>
            </svg>
        </button>
  </div>
  <app-add-task *ngIf="showAddOrEditTask"></app-add-task>
 </div>
</div> -->

<div
  class="task-overlay"
  [@slideInOut]="animationDirection"
  (@slideInOut.done)="onOverlayAnimationDone($event)"
  [class.backgroundVisible]="backgroundVisible"
  *ngIf="backgroundVisible"
>
  <div class="content-wrapper" *ngIf="showAddOrEditTask">
    <div class="close-btn-wrapper" >
      <button class="btn-close" (click)="closeDetailsOverlay('close')">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <mask id="mask0_331509_883" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
                    <rect width="24" height="24" fill="#D9D9D9"/>
                </mask>
                <g mask="url(#mask0_331509_883)">
                    <path d="M12 13.4L7.10005 18.3C6.91672 18.4834 6.68338 18.575 6.40005 18.575C6.11672 18.575 5.88338 18.4834 5.70005 18.3C5.51672 18.1167 5.42505 17.8834 5.42505 17.6C5.42505 17.3167 5.51672 17.0834 5.70005 16.9L10.6 12L5.70005 7.10005C5.51672 6.91672 5.42505 6.68338 5.42505 6.40005C5.42505 6.11672 5.51672 5.88338 5.70005 5.70005C5.88338 5.51672 6.11672 5.42505 6.40005 5.42505C6.68338 5.42505 6.91672 5.51672 7.10005 5.70005L12 10.6L16.9 5.70005C17.0834 5.51672 17.3167 5.42505 17.6 5.42505C17.8834 5.42505 18.1167 5.51672 18.3 5.70005C18.4834 5.88338 18.575 6.11672 18.575 6.40005C18.575 6.68338 18.4834 6.91672 18.3 7.10005L13.4 12L18.3 16.9C18.4834 17.0834 18.575 17.3167 18.575 17.6C18.575 17.8834 18.4834 18.1167 18.3 18.3C18.1167 18.4834 17.8834 18.575 17.6 18.575C17.3167 18.575 17.0834 18.4834 16.9 18.3L12 13.4Z" fill="#2A3647"/>
                </g>
            </svg>
      </button>
    </div>
    <app-add-task *ngIf="showAddOrEditTask"></app-add-task>
  </div>
  <app-task-details
      *ngIf="showTaskDetails && selectedTask"
      (closeTaskDetails)="closeDetailsOverlay($event)"
      (editTask)="openAddOrEditOverlay('edit')"
      (subtaskChanged)="onSubtaskUpdate($event)"
      [task]="selectedTask"
      [contactList]="contactList"
    ></app-task-details>
</div>